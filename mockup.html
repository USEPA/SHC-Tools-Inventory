<!DOCTYPE html>
<!--[if IEMobile 7]><html class="iem7 no-js" lang="en" dir="ltr"><![endif]-->
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js" lang="en" dir="ltr"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)]><!--> <html class="no-js not-oldie" lang="en" dir="ltr"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="true" />
  <link rel="shortcut icon" href="https://www.epa.gov/sites/all/themes/epa/favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="MobileOptimized" content="width" />
  <meta http-equiv="cleartype" content="on" />
  <meta http-equiv="ImageToolbar" content="false" />
  <meta name="viewport" content="width=device-width" />
  <meta name="version" content="20161218" />
<!--googleon: all-->
  <meta name="DC.description" content="" />
  <meta name="DC.title" content="" />
  <title> SHC Tool Finder</title>
<!--googleoff: snippet-->
  <meta name="keywords" content="" />
  <link rel="shortlink" href="" />
  <link rel="canonical" href="" />
  <meta name="DC.creator" content="" />
  <meta name="DC.language" content="en" />
  <meta name="DC.Subject.epachannel" content="" />
  <meta name="DC.type" content="" />
  <meta name="DC.date.created" content="" />
  <meta name="DC.date.modified" content="" />
<!--googleoff: all-->
  <link type="text/css" rel="stylesheet" href="https://www.epa.gov/sites/all/libraries/template2/s.css" media="all" />
  <!--[if lt IE 9]><link type="text/css" rel="stylesheet" href="https://www.epa.gov/sites/all/themes/epa/css/ie.css" media="all" /><![endif]-->
  <link rel="alternate" type="application/atom+xml" title="EPA.gov All Press Releases" href="https://www.epa.gov/newsreleases/search/rss" />
  <link rel="alternate" type="application/atom+xml" title="EPA.gov Headquarters Press Releases" href="https://www.epa.gov/newsreleases/search/rss/field_press_office/headquarters" />
  <link rel="alternate" type="application/atom+xml" title="Greenversations, EPA's Blog" href="https://blog.epa.gov/blog/feed/" />
  <!--[if lt IE 9]><script src="https://www.epa.gov/sites/all/themes/epa/js/html5.js"></script><![endif]-->
  <style>
    .next{
      position: fixed;
      bottom: 0;
      margin: 0 auto;
      border: 1vh solid green;
    }
    #search-results > :hover{
      background-color: #e7f4e4;
    }
    select{overflow: auto;}
    [role=tab]{
      margin: 1px 0 0;
      border-bottom-left-radius:0;
      border-bottom-right-radius:0;
    }
    [role=tabpanel]{
      padding: 1px;
      border: 2px solid #d6d7d9;
      border-radius: 5px;
      border-top-left-radius:0;
      border-top-right-radius:0;
    }
    div[aria-hidden='true']{display: none;}
    *.hidden{display: none;}
    #search-terms span{
      border: 1px solid gray;
      margin: .1em;
    }
    [name=role-checkbox]:checked + label{
      background-color:#112e51;
    }
    /* Makes text in an element unselectable */
    .unselectable{
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -o-user-select: none;
      user-select: none;
      margin: 0 .15em .3em;
      padding: 0.4em;
    }
    .inline{
      display: inline;
      padding-left: 5px;
    }
    #search-results > div{
      background-color: #f1f1f1;
      margin-top: .5em;
      border-radius: 5px;
      padding: 2px;
    }
    .flex{
      display: flex;
    }
    .left{
      flex: 0 0 50%;
    }
    .right{
      flex: 1;
    }
    button:disabled{background-color:#aeb0b5}
    *{
      -ms-transition: none;
      transition: none;
    }
    .accordian-result{
    background-image: url(https://www.epa.gov/sites/all/themes/epa/img/arrow-alt-down.png);
    background-size: 100% 100%;
    float: right;
    height: 13px;
    margin: 5px;
    width: 13px;
    }
    .collapsible{
      transform: rotateX(180deg);
    }
  </style>
</head>
<!-- NOTE, figure out body classes! -->
<body class="node-type-(web-area|page|document|webform) (microsite|resource-directory)" >
  <!-- Google Tag Manager -->
  <!--REMOVED FOR DEVELOPMENT; REPLACE FOR PRODUCTION
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-L8ZB" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-L8ZB');</script>
  -->
  <!-- End Google Tag Manager -->
  <div class="skip-links"><a href="#main-content" class="skip-link element-invisible element-focusable">Jump to main content</a></div>
  <header class="masthead clearfix" role="banner">
    <img class="site-logo" src="https://www.epa.gov/sites/all/themes/epa/logo.png" alt="" />
    <hgroup class="site-name-and-slogan">
      <h1 class="site-name"><a href="https://www.epa.gov/" title="Go to the home page" rel="home"><span>US EPA</span></a></h1>
      <div class="site-slogan">United States Environmental Protection Agency</div>
    </hgroup>
    <form class="epa-search" method="get" action="https://search.epa.gov/epasearch/epasearch">
      <label class="element-hidden" for="search-box">Search</label>
      <input class="form-text" placeholder="Search EPA.gov" name="querytext" id="search-box" value="" />
      <button class="epa-search-button" id="search-button" type="submit" title="Search">Search</button>
      <input type="hidden" name="areaname" value="" />
      <input type="hidden" name="areacontacts" value="" />
      <input type="hidden" name="areasearchurl" value="" />
      <input type="hidden" name="typeofsearch" value="epa" />
      <input type="hidden" name="result_template" value="2col.ftl" />
    </form>
  </header>
  <section id="main-content" class="main-content clearfix" role="main">
    <div class="region-preface clearfix">
      <div id="block-pane-epa-web-area-connect" class="block block-pane contextual-links-region">
        <ul class="menu utility-menu">
          <li class="menu-item"><a href="{CONTACT URL}" class="menu-link contact-us">Contact Us</a></li>
        </ul>
      </div>
    </div>
    <div class="main-column clearfix">
    <!--googleon: all-->
      <h1 class="page-title">SHC Tool Finder</h1>
      <div class="panel-pane pane-node-content" >
        <div class="pane-content">
          <div class="node node-page clearfix view-mode-full">
            <div id="main-tabs">
                <div id="explore-tab-container" role="tablist">
                  <button aria-controls="role-panel" aria-selected="true" id="explore-role-tab" role="tab" name="tab2" tabindex="-1" data-tab-number="1">Role</button>
                  <button aria-controls="subrole-panel" aria-selected="false" id="explore-subrole-tab" role="tab" name="tab2" tabindex="-1" disabled data-tab-number="2">Subrole</button>
                  <button aria-controls="fundamental-objective-panel" aria-selected="false" id="explore-fundamental-objective-tab" role="tab" name="tab2" tabindex="-1" disabled data-tab-number="3">Fundamental Objective</button>
                  <button aria-controls="objective-panel" aria-selected="false" id="explore-objective-tab" role="tab" name="tab2" tabindex="-1" disabled data-tab-number="4">Objective</button>
                  <button aria-controls="concept-panel" aria-selected="false" id="explore-concept-tab" role="tab" name="tab2" tabindex="-1" disabled data-tab-number="5">Concept</button>
                </div>
                <div aria-labelledby="explore-role-tab" id="role-panel" role="tabpanel" name="tab2panel" aria-hidden="false">
                  <label for="role-select">Who will use the tools? Select roles and proceed to the Subrole tab.</label>
                  <select multiple id="role-select" onchange="roleSelect()" size="14">
                    <option>Community Representative/Volunteer</option>
                    <option>Developer</option>
                    <option>Engineer/Architect/Designer</option>
                    <option>Environmental Group Representative</option>
                    <option>Farmer</option>
                    <option>Industrial or Commercial Facility Representative</option>
                    <option>Land Use, City, or Regional Planner</option>
                    <option>Landowner/Homeowner</option>
                    <option>Natural Resource Manager</option>
                    <option>Regulatory Official</option>
                    <option>Scientist/Academic</option>
                    <option>Sustainability or Environmental Program Coordinator</option>
                    <option>Urban Forest Manager</option>
                    <option>Water Utility Manager</option>
                  </select>
                  <br />
                  <button class="next enabled-by-subrole-select" onclick="activateNextTab($('#explore-subrole-tab'))" disabled>Next</button>
                </div>
                <div aria-labelledby="explore-subrole-tab" id="subrole-panel" role="tabpanel" name="tab2panel" aria-hidden="true">
                  <label for="subrole-select">Provide some more information about your roles, and then proceed to the Objective tab.</label>
                  <select multiple id="subrole-select" onchange="subroleSelect()"></select>
                  <br />
                  <button class="next enabled-by-fundamental-objective-select" onclick="activateNextTab($('#explore-fundamental-objective-tab'))" disabled>Next</button>
                </div>
                <div aria-labelledby="explore-fundamental-objective-tab" id="fundamental-objective-panel" role="tabpanel" name="tab2panel" aria-hidden="true">
                  <label for="fundamental-objective-select">Choose fundamental objectives and proceed to the next tab.</label>
                  <select multiple id="fundamental-objective-select" onchange="fundamentalObjectiveSelect()"></select>
                  <br />
                  <button class="next enabled-by-objective-select" onclick="activateNextTab($('#explore-objective-tab'))" disabled>Next</button>
                </div>
                <div aria-labelledby="explore-objective-tab" id="objective-panel" role="tabpanel" name="tab2panel" aria-hidden="true">
                  <label for="objective-select">What are the user's goals? Select objectives for the desired tools and move to the next tab.</label>
                  <button onclick="objectiveDisplay(1)" id="objective-relevance-increase">Show more objectives</button>
                  <button onclick="objectiveDisplay(-1)" id="objective-relevance-decrease">Show less objectives</button>
                  <br />
                  <input id="objective-relevance" type="hidden" value="1" />
                  <select multiple id="objective-select" onchange="objectiveSelect()"></select>
                  <br />
                  <button class="next enabled-by-concept-select" onclick="activateNextTab($('#explore-concept-tab'))" disabled>Next</button>
                </div>
                <div aria-labelledby="explore-concept-tab" id="concept-panel" role="tabpanel" name="tab2panel" aria-hidden="true">
                  <h3>Concepts</h3>
                  <label for="concept-select">Select all concepts that apply to the intended use of the tool. Clink Find Tools to display a list of tools or click Add Additional Concepts to choose from more concepts.</label>
                  <select multiple id="concept-select"></select>
                  <br />
                  <button id="expand-concepts" onclick="broadenConcepts()">Add Additional Concepts</button>
                  <button id="keyword-search-button" onclick="keywordSearch('search-results', '#concept-select option:selected')">Find Tools</button>
                </div>
                <div id="search-results"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="block-epa-og-footer" class="block block-epa-og">
      </div>
<!--googleoff: all-->
    </div>
  </section>
  <nav class="nav simple-nav simple-main-nav" role="navigation">
    <div class="nav__inner">
      <h2 class="element-invisible">Main menu</h2>
      <ul class="menu" role="menu">
        <li class="menu-item" id="menu-learn" role="presentation"><a href="https://www.epa.gov/environmental-topics" title="Learn about Environmental Topics that EPA covers." class="menu-link" role="menuitem">Environmental Topics</a></li>
        <li class="menu-item" id="menu-lawsregs" role="presentation"><a href="https://www.epa.gov/laws-regulations" title="Laws written by Congress provide the authority for EPA to write regulations. Regulations explain the technical, operational, and legal details necessary to implement laws." class="menu-link" role="menuitem">Laws &amp; Regulations</a></li>
        <li class="menu-item" id="menu-about" role="presentation"><a href="https://www.epa.gov/aboutepa" title="Learn more about: our mission and what we do, how we are organized, and our history." class="menu-link" role="menuitem">About EPA</a></li>
      </ul>
    </div>
  </nav>
  <footer class="main-footer clearfix" role="contentinfo">
    <div class="main-footer__inner">
      <div class="region-footer">
        <div class="block block-pane block-pane-epa-global-footer">
          <div class="row cols-3">
            <div class="col size-1of3">
              <div class="col__title">Discover.</div>
              <ul class="menu">
                <li><a href="https://www.epa.gov/accessibility">Accessibility</a></li>
                <li><a href="https://www.epa.gov/aboutepa/administrator-gina-mccarthy">EPA Administrator</a></li>
                <li><a href="https://www.epa.gov/planandbudget">Budget &amp; Performance</a></li>
                <li><a href="https://www.epa.gov/contracts">Contracting</a></li>
                <li><a href="https://www.epa.gov/home/grants-and-other-funding-opportunities">Grants</a></li>
                <li><a href="https://www.epa.gov/ocr/whistleblower-protections-epa-and-how-they-relate-non-disclosure-agreements-signed-epa-employees">No FEAR Act Data</a></li>
                <li><a href="https://www.epa.gov/home/privacy-and-security-notice">Privacy and Security</a></li>
              </ul>
            </div>
            <div class="col size-1of3">
              <div class="col__title">Connect.</div>
              <ul class="menu">
                <li><a href="https://www.data.gov/">Data.gov</a></li>
                <li><a href="https://www.epa.gov/office-inspector-general/about-epas-office-inspector-general">Inspector General</a></li>
                <li><a href="https://www.epa.gov/careers">Jobs</a></li>
                <li><a href="https://www.epa.gov/newsroom">Newsroom</a></li>
                <li><a href="https://www.whitehouse.gov/open">Open Government</a></li>
                <li><a href="http://www.regulations.gov/">Regulations.gov</a></li>
                <li><a href="https://www.epa.gov/newsroom/email-subscriptions">Subscribe</a></li>
                <li><a href="https://www.usa.gov/">USA.gov</a></li>
                <li><a href="https://www.whitehouse.gov/">White House</a></li>
              </ul>
            </div>
            <div class="col size-1of3">
              <div class="col__title">Ask.</div>
              <ul class="menu">
                <li><a href="https://www.epa.gov/home/forms/contact-us">Contact Us</a></li>
                <li><a href="https://www.epa.gov/home/epa-hotlines">Hotlines</a></li>
                <li><a href="https://www.epa.gov/foia">FOIA Requests</a></li>
                <li><a href="https://www.epa.gov/home/frequent-questions-specific-epa-programstopics">Frequent Questions</a></li>
              </ul>
              <div class="col__title">Follow.</div>
              <ul class="social-menu">
                <li><a class="menu-link social-facebook" href="https://www.facebook.com/EPA">Facebook</a></li>
                <li><a class="menu-link social-twitter" href="https://twitter.com/epa">Twitter</a></li>
                <li><a class="menu-link social-youtube" href="https://www.youtube.com/user/USEPAgov">YouTube</a></li>
                <li><a class="menu-link social-flickr" href="https://www.flickr.com/photos/usepagov">Flickr</a></li>
                <li><a class="menu-link social-instagram" href="https://instagram.com/epagov">Instagram</a></li>
              </ul>
              <p class="last-updated">2017.01.05</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://www.epa.gov/sites/all/libraries/template2/jquery.js"></script>
  <script src="https://www.epa.gov/sites/all/libraries/template2/js.js"></script>
  <script src="https://www.epa.gov/sites/all/modules/custom/epa_core/js/alert.js"></script>
  <!--[if lt IE 9]><script src="https://www.epa.gov/sites/all/themes/epa/js/ie.js"></script><![endif]-->
<script src="js/porter-stemmer.js"></script>
<script src="js/DPL-data.js"></script>
<script>
$ = jQuery;// ensure jquery gets where it's expected
$("#explore-role-tab").focus();
var resourceSearchURL = "https://ofmpub.epa.gov/readwebservices/v1/ResourceSearch";
var resourceAdvancedSearchURL = "https://ofmpub.epa.gov/readwebservices/v1/ResourceAdvancedSearch";
var resourceDetailURL = "https://ofmpub.epa.gov/readwebservices/v1/ResourceDetail";
var advancedSearchFields = ["Name","Acronym","ShortDescriptionForReports","OwnershipType","OtherCostConsiderations","OpenSource","AlternativeNames","Keywords","Organization","ContactPerson","Email","Internet","LifeCycle","OperatingEnvironment","CompatibleOperatingSystems","OtherPropSoftwareReqs","ModelInputs","DataRequirements","ModelOutputTypes","OutputVariables","SourceOfSupportMaterials","TypesOfSupportMaterials","ModelEvaluation","ModelStructure","TimeScale","SpatialExtent","TechSkills","BaseCostOfSoftware","StewardDefinedTags","DecisionSector","Format"];
var decisionSectors = ['land use','transportation','building infrastructure','waste management'];
var stopWords = ["&","a","about","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","computer","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","i","ie","if","in","inc","indeed","interest","into","is","it","its","itself","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","show","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thick","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves"];

/** search and update terms, useful to maintain a view
  * of what has been searched for to yield results */
var search = function(str){
  var terms = str.split(" ");
  $.each(terms, function(index, value){
      $('<button>',{ 'text': value }).appendTo('#search-terms');
  } );
};

/** DESCRIBE FUNCTIONALITY */
var objectiveDisplay = function(adjust){
  $('#objective-relevance').val(parseInt($('#objective-relevance').val()) + parseInt(adjust));
  var val = $('#objective-relevance').val();
  if (val<=0){
    $('#objective-relevance-decrease').prop('disabled', true);
  }else if (val>=2){
    $('#objective-relevance-increase').prop('disabled', true);
  }else{
    $('#objective-relevance-decrease').prop('disabled', false);
    $('#objective-relevance-increase').prop('disabled', false);
  }
  fundamentalObjectiveSelect();
};

// This listener prevents accidentally clearing a listbox with a stray click of
// the mouse by making a click toggle the selection state of only the clicked option.
$('select').on('mousedown','option',function(e){
    e.preventDefault();// prevent default handling of event
    $(this).prop('selected',!$(this).prop('selected'));// toggle selection property's existence
    $(this).change();// fire the change event in order to trigger onchange listeners
    return false;// return false when successful(implements naive error handling)
} );

/** listener:select only "clicked" tab and show only this tab's corresponding panel */
$('[role="tab"]').click(function(){
    var $this = $(this)
    var tab = $this.attr('name');
    $('[name="'+tab+'"]').attr('aria-selected', 'false');// deselect all tabs
    $this.attr('aria-selected', 'true');// select clicked tab
    var tabpanid= $this.attr('aria-controls');// get the id of the panel controlled by the clicked tab
    var tabpan= $('#'+tabpanid);// get panel's document-element from its id
    $('[name="'+tab+'panel"]').attr('aria-hidden','true');// hide all panels
    tabpan.attr('aria-hidden','false');// show the clicked tab's panel
});

/** populate a list into specified $container of elements */
var populate = function(list, $container, element){
  if (typeof list === 'undefined'){list = [];}
  $container.html('');
  $.each(list, function(index, value){
    $container.append($("<"+element+"></"+element+">").text(value));
  } );
  $container.attr('size', list.length+1);
  toggleTab(list, $container);// enable next tab iff list not empty
  var nextButtonClassSubstring = $container[0].id;// identify next button by who enables it
  toggleNext(list, nextButtonClassSubstring);// enable next button iff list not empty 
};

/** toggle disabled state of a next button */
var toggleNext = function(list, nextButtonClassSubstring){
  var nextButtonSelector = '.enabled-by-'+nextButtonClassSubstring// identify next button by who enables it
  if (list.length > 0){
    $(nextButtonSelector).prop('disabled',false);
  }else{
    $(nextButtonSelector).prop('disabled',true);
  }
};

/** toggle disabled state of a tab */
var toggleTab = function(list, $container){
  if (list.length > 0){
    $('#'+$container.parent().attr('aria-labelledby')).prop('disabled',false);
  }else{
    $('#'+$container.parent().attr('aria-labelledby')).prop('disabled',true);
  }
};

/** populate #subrole-select with subrole options for the
  * selected roles */
var roleSelect = function(){
  populate(scrapeDictionary($('#role-select option:selected'),subrolesByRole),$('#subrole-select'),'option');
  subroleSelect();
  $('#explore-fundamental-objective-tab').prop('disabled',true);
};

/** populate #objective-select with objective options for
  * the selected subroles */
var subroleSelect = function(){
  var list =[];
  if ($( '#subrole-select option:selected').length != 0){
    list = Object.keys(objectivesByFundamentalObjective);
  }
  populate(list,$('#fundamental-objective-select'),'option');
  fundamentalObjectiveSelect();
};

/** populate #objective-select with objectives determined by selected subroles and fundamental objectives */
var fundamentalObjectiveSelect = function(){
  // get objectives specified by selected subroles
  //var objectivesFromSubroles = scrapeDictionary($('#subrole-select option:selected'),objectivesBySubrole);
  var relevance = $('#objective-relevance').val();
  var objectivesFromSubroles = [];
  for (var i=0;i<=relevance;i++){
    objectivesFromSubroles = objectivesFromSubroles.concat(scrapeDictionary($('#subrole-select option:selected'),objectivesBySubroleRelevance[i]));
  }
  // get objectives specified by selected fundamental objectives
  var objectivesFromFundamentalObjectives = scrapeDictionary($('#fundamental-objective-select option:selected'),objectivesByFundamentalObjective);
  // get objectives specified by both subroles and fundamental objectives
  var objectives = objectivesFromSubroles
    .filter(function(element){
        return objectivesFromFundamentalObjectives.indexOf(element) != -1;
    });
  populate(objectives,$('#objective-select'),'option');
  objectiveSelect();
};

/** populate #concept-select with concept-options for selected objectives */
var objectiveSelect = function(){
  populate(scrapeDictionary($('#objective-select option:selected'),conceptsByObjective),$('#concept-select'),'option');
};

/** get elements of arrays in dictionary without repeats */
var scrapeDictionary = function(selectedOptions, dictionary){
  var selectedElement = '';
  var selectedElements = [];
  var allSelectedElements = [];
  for (var i = 0; i < selectedOptions.length; i++){
    selectedElement = selectedOptions[i].value;
    selectedElements = dictionary[selectedElement];
    if (typeof selectedElements === 'undefined'){
      selectedElements = [];
    }
    for (var j=0;j<selectedElements.length;j++){
      if(allSelectedElements.indexOf(selectedElements[j]) === -1){
        allSelectedElements.push(selectedElements[j]);
      }
    }
  }
  return allSelectedElements.sort();
};

/** add checkbox with text of name to container with containerId */
function addCheckbox(name, containerId){
  var container = $('#'+containerId);
  var inputs = container.find('input');
  var id = inputs.length+1;
  $('<input />',{ type: 'checkbox', id: 'cb'+containerId+id, value: name, name: containerId+'-checkbox' }).appendTo(container);
  $('<label />',{ 'for': 'cb'+containerId+id, text: name }).appendTo(container);
};

/** search in descriptions for each word in query string from input and display results in div */
var keywordSearch = function(div, input){
  $('#'+div+' *').remove();
  clearResultData(div);
  var keywords = getKeywords(input);
  for (var i=0; i<keywords.length; i++){
    for (var j=0; j<decisionSectors.length; j++){
      $.get('https://ofmpub.epa.gov/readwebservices/v1/ResourceAdvancedSearch',
        {
          ShortDescriptionForReports: keywords[i],
          DecisionSector: decisionSectors[j]
        }
      ).done(function(data){
        for (var i=0; i<data.length; i++){
          getResourceDetail(data[i].ResourceId, div);
        }
      });
    }
  }
};

/** get keywords from input as a list */
var getKeywords = function(input){
  var concept = '';
  var concepts = [];
  var keyword = '';
  var keywords = [];
  $(input).each(function(){
    concept = $(this).val();
    if (concept.length > 1){
      keywords = concept.split(' ');
      for (i=0; i<keywords.length; i++){
        keyword = keywords[i];
        if ((concepts.indexOf(keyword) === -1) && (keyword.length > 3)){
          concepts.push(keyword);
        }
      }
    }
  });
  return concepts;
};

/** return details of id into div */
var getResourceDetail = function(id, div){
  $.get(resourceDetailURL,{ ResourceId: id }).done(function(data){displayResult(data, div)});
};

/** display a result; save result's data to the containing element
  * @arg data{object} READ Web Services detail object */
var displayResult = function(data, div, fields){
  fields = (typeof fields !== 'undefined') ?  fields : ['title'];
  var containerId = div;
  var parsedResult = parseResult(data);
  fields = ['title', 'description', 'url'];
  if (isNewResult(containerId, parsedResult)){addDiv(parsedResult, containerId)}
};

/** display details of parsedResult in container with containerId
  * dev aspiration: dynamically append spans and dynamically apply
  *                 .left class or .right class to each in order
  *                 to balance columns*/
function addDiv(parsedResult, containerId){
  var container = $('#'+containerId);
  $(container).append(
    $('<div />')
      .attr('id', parsedResult.id)
      .append(
        $('<div />')
          .click(function(){
            $("#additional-details-"+parsedResult.id).toggle();
            $(this).find('.accordian-result').toggleClass('collapsible');
          })
        .append(
          $('<span />')
            .html('<strong>'+parsedResult.title+' ('+parsedResult.acronym+')</strong>: '+parsedResult.description)
            .append(
          $('<span />')
            .addClass('accordian-result'))))
      .append(
        $('<div />')
          .css('display', 'none')
          .attr('id', 'additional-details-'+parsedResult.id)
          .addClass('flex')
        .append(
          $('<span />')    
            .addClass('left')
            .append(
              $('<span />')
                .html('<strong>Contact Name</strong>: '+validata(parsedResult.contactName)+'<br />'))
            .append(
              $('<span />')
                .html('<strong>Contact Email</strong>: '+validata(parsedResult.contactEmail)+'<br />'))
            .append(
              $('<span />')
                .html('<strong>Contact Phone</strong>: '+validata(parsedResult.contactPhoneNumber)+'<br />')))
        .append(
          $('<span />')
            .addClass('right')
            .append(
              $('<span />')
                .html('<strong>Keywords</strong>: '+validata(parsedResult.keywords)+'<br />'))
            .append(
              $('<span />')
                .html('<strong>Tags</strong>: '+validata(parsedResult.tags)+'<br />'))
            .append(
              $('<a />')
                .attr('href',parsedResult.url)
                .attr('target', '_blank')
                .text('Visit the tool\'s homepage')
                .attr('onclick','stopPropagation(event);'))))
  );
  var divs = container.find('div');
};

/** map details of a result into known locations */
var parseResult = function(result){
  //console.log('parsing ',result);
  if(typeof(result)=='undefined'){return}
  var parsedResult = {
    id: result['READExportDetail']['InfoResourceDetail']['READResourceIdentifier'],
    title: result['READExportDetail']['InfoResourceDetail']['GeneralDetail']['LongTitleText'],
    description: result['READExportDetail']['InfoResourceDetail']['GeneralDetail']['LongDescription'],
    acronym: result['READExportDetail']['InfoResourceDetail']['GeneralDetail']['Acronym'],
    keywords: result['READExportDetail']['InfoResourceDetail']['KeywordDetail']['KeywordText'],
    contactName: result['READExportDetail']['InfoResourceDetail']['UserSupportDetail']['UserSupportName'],
    contactEmail: result['READExportDetail']['InfoResourceDetail']['UserSupportDetail']['UserSupportEmail'],
    contactPhoneNumber: result['READExportDetail']['InfoResourceDetail']['UserSupportDetail']['UserSupportPhoneNumber'],
    url: result['READExportDetail']['InfoResourceDetail']['AccessDetail']['InternetDetail']['URLText'],
    tags: result['READExportDetail']['InfoResourceDetail']['TagDetail']['InfoResourceStewardTagText'],
  };
  parsedResult.helpDeskEmail = readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','InternetDetail','HelpDeskEmailAddressText']);
  console.log('id: ',parsedResult.id,'readSafe assigned helpDeskEmail: ',parsedResult.helpDeskEmail);
  additionalData = {};
  readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','InternetDetail','HelpDeskTelephoneNumber'],additionalData,helpDeskTelephone);
  additionalData.intranetHelpDeskEmail = readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','IntranetDetail','HelpDeskEmailAddressText']);
  additionalData.intranetHelpDeskTelephone = readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','IntranetDetail','HelpDeskTelephoneNumber']);
  additionalData.intranetUrl = readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','IntranetDetail','URLText']);
  additionalData.rcsResource = readSafe(result,['READExportDetail','InfoResourceDetail','AccessDetail','RCSDetail','RCSResources']);
  additionalData.ownershipType = readSafe(result,['READExportDetail','InfoResourceDetail','GeneralDetail','OwnershipTypeName']);
  additionalData.softwareCost = readSafe(result,['READExportDetail','InfoResourceDetail','ModelDetailsDetail','DetailsBaseSoftwareCost']);
  additionalData.otherCost = readSafe(result,['READExportDetail','InfoResourceDetail','ModelDetailsDetail','DetailsOtherCostConsiderations']);
  additionalData.openSource = readSafe(result,['READExportDetail','InfoResourceDetail','ModelDetailsDetail','DetailsOpenSource']);
  additionalData.alternativeNames = readSafe(result,['READExportDetail','InfoResourceDetail','ModelDetailsDetail','DetailsOtherCostConsiderations']);
  additionalData.sector = readSafe(result,['READExportDetail','InfoResourceDetail','ModelScopeDetail','ModelScopeDecisionSector']);
  additionalData.constrainedKeywords = readSafe(result,['READExportDetail','InfoResourceDetail','UserSupportDetail','UserSupportSourceOfSupportMaterials']);
  additionalData.lifeCyclePhase = readSafe(result,['READExportDetail','InfoResourceDetail','LifeCycleDetail','CurrentLifeCyclePhase']);
  additionalData.lastModified = readSafe(result,['READExportDetail','InfoResourceDetail','LastModifiedDateTimeText']);
  additionalData.lastModifiedBy = readSafe(result,['READExportDetail','InfoResourceDetail','LastModifiedPersonName']);
  additionalData.operatingEnvironment = readSafe(result,['READExportDetail','InfoResourceDetail','TechRequirementsDetail','TechReqCompatibleOSDetail','OSName']);
  additionalData.otherTechnicalRequirements = readSafe(result,['READExportDetail','InfoResourceDetail','TechRequirementsDetail','TechReqOtherReqDetail','OtherReqName']);
  additionalData.modelInputs = readSafe(result,['READExportDetail','InfoResourceDetail','ModelInputsDetail','ModelInputsTextArea']);
  additionalData.modelOutputs = readSafe(result,['READExportDetail','InfoResourceDetail','ModelOutputsDetail','ModelOutputsModelVariablesTextArea']);
  additionalData.supportMaterial = readSafe(result,['READExportDetail','InfoResourceDetail','UserSupportDetail','UserSupportSourceOfSupportMaterials']);
  additionalData.modelEvaluation = readSafe(result,['READExportDetail','InfoResourceDetail','ModelEvaluationDetail','ModelEvaluationTextArea']);
  additionalData.modelTimeScale = readSafe(result,['READExportDetail','InfoResourceDetail','ModelScopeDetail','ModelScopeTimeScaleDetail']);
  additionalData.spatialExtent = readSafe(result,['READExportDetail','InfoResourceDetail','ModelScopeDetail','ModelScopeSpatialExtentDetail']);
  additionalData.dataRequirements = readSafe(result,['READExportDetail','InfoResourceDetail','ModelInputsDetail','ModelInputsDataRequirements']);
  console.log('additionalData:',additionalData,'parsedResult:',parsedResult);
  return parsedResult
};

/** check existence of each prop_i in obj.prop_1...prop_n
  * and assign argument assignee[assignedPropertyName]
  * readSafe(obj, [prop_1,...,prop_n], assignee, assignedPropertyName)
  * s.t. assignee[assignedPropertyName] = obj.prop_1...prop_n if
  * prop_n exists where expected.
  * @arg object{object} test the properties of object
  * @arg propertyArray{array} [prop_1,...,prop_n] s.t.
  *      object[prop_1][...][prop_n] is the desired value
  * @arg assignee{any type} specifies location to which the
  *      validated desired value will be assigned(optional)
  * @arg assignedPropertyName{string} name of assignee's
  *      property to be set with safely read value
  * E.G.: readSafe(obj,['foo','bar','baz'],assignee,assignedPropertyName)
  * safely attempts (assignee[assignedPropertyName] = obj.foo.bar.baz)
  * or returns final propertys' value if all properties exist
  * and fails safely to (assignee[assignedPropertyName] = 'no data')
  * or (return false) if no assignee[assignedPropertyName] passed */
function readSafe(object, propertyArray, assignee, assignedPropertyName){
  if(object[propertyArray[0]]){// is first element of propertyArray a property of this object?
    var value = validata(object[propertyArray[0]]);// oft-used value is sensibly extant
    if(Object.keys(propertyArray).length==1){// is this the last property in the array?
      //console.log('propertyArray is only one element:',propertyArray[0],'object[propertyArray[0]:',value);// dev
      if(typeof(assignee[assignedPropertyName])!='undefined'){// is arg assignee[assignedPropertyName] defined?
        assignee[assignedPropertyName] = value;// success: assignee gets property's validated value
        console.log('assignee[assignedPropertyName] assigned: ',assignee[assignedPropertyName]);// dev
      }else{
        console.log('SUCCESS: return ',value);// dev
        return value;// if no assignee[assignedPropertyName] then return contents of property
      }
    }else{// there are multiple elements remaining in propertyArray that we need to descend into
      try{
        //console.log('readSafe iterating with value: ',value);// dev
        readSafe(value,// recursion with obj[prop_1] as obj for next iteration
            propertyArray.slice(1),// pass the second element through the last element of the property array
            assignee,// assignee comes along for the ride
            assignedPropertyName);// the property's name is needed and so passed
      }catch(e){
        console.log('error: ',e);// dev
        if(typeof(assignee[assignedPropertyName])!='undefined'){assignee[assignedPropertyName] = 'no data'}else{return 'no data'}// fail safely: assignee[assignedPropertyName] set to 'no data' else return 'no data'
      }
    }
  }else{//fail: element zero of propertyArray isn't a property of this object
    console.log('readSafe is tripping on object:',object,' at property:',propertyArray[0]);// dev
    if(typeof(assignee[assignedPropertyName])!='undefined'){assignee[assignedPropertyName] = 'no data'}else{return false}// fail safely: assignee[assignedPropertyName] set to 'no data' or return 'no data'
  }
}

/** clear results and their cached ids */
var clearResultData = function(div){
  container = $('#'+div);
  ids = container.data('ids');
  if (typeof(ids) != 'undefined'){
    for (i=0;i<ids.length;i++){
      id = ids[i];
      container.removeData(id)
    }
    ids.length = 0;
  }
}

/** true if tool is not already in results
  * @arg containerId is the id of container for results
  * @arg parsedResult is the result whose details are returned from parseResults */
var isNewResult = function(containerId, parsedResult){
  if (typeof($('#'+containerId).data('ids')) == 'undefined'){$('#'+containerId).data('ids',[])}
  var cachedIds = $('#'+containerId).data('ids');
  if(cachedIds.indexOf(parsedResult.id)==-1){
    cachedIds.push(parsedResult.id)
    $('#'+containerId).data(String(parsedResult.id), JSON.stringify(parsedResult));
    return true
  }
  return false
};

/** get selected concepts by default or all concepts shown when given argument selected==false
  * @arg selected{boolean} default of true gets selected concepts, false returns all concepts displayed */
var getConcepts = function(selected){
  selected = (typeof selected !== 'undefined') ?  selected : true;
  var concept = '';
  var concepts = [];
  var selector = '#concept-select option';
  if (selected==true){selector=selector+':selected'}
  $(selector).each(function(){
    concept = $(this).val();
    concepts.push(concept);
  });
  return concepts;
};

/** find all concepts associated with selected concepts by being grouped in same objective */
var broadenConcepts = function(){
  // get all concepts
  var allConcepts = getConcepts(false)
  // get selected concepts
  var selectedConcepts = getConcepts();
  // iterate through conceptsByObjective for all objectives associated with selected concepts
  var associatedObjectives = [];
  for (objective in conceptsByObjective){
    if (conceptsByObjective.hasOwnProperty(objective)){
      for (j=0;j<selectedConcepts.length;j++){
        if ((conceptsByObjective[objective].indexOf(selectedConcepts[j])!=-1)&&
            (associatedObjectives.indexOf(objective)==-1)){
          associatedObjectives.push(objective)
        } }
    }
  }
  // possibly let user select objectives from those found above
  // collect all concepts indexed by these objectives
  var associatedConcepts = [];
  for (i=0;i<associatedObjectives.length;i++){
    for (j=0;j<conceptsByObjective[associatedObjectives[i]].length;j++){
      conceptsToCheckForDuplicates = associatedConcepts.concat(allConcepts)
      candidateConcept = conceptsByObjective[associatedObjectives[i]][j]
      if ((conceptsToCheckForDuplicates.indexOf(candidateConcept)==-1)&&(candidateConcept.length>1)){
        associatedConcepts.push(candidateConcept)
      }
    }
  }
  // possibly let user select from among these concepts
  for (i=0;i<associatedConcepts.length;i++){
    $('#concept-select').append('<option>'+associatedConcepts[i]+'</option>');
    $('#concept-select').css('overflow','visible');
    $('#concept-select').attr('size',$('concept-select').children().length)
  }
}

/** check if object represents xsi:nil or unsanitized absence of data */
var isNil = function(obj){
  return (typeof(obj)==='undefined'||obj.hasOwnProperty('xsi:nil')||obj===null||obj.toString()==='');
};

/** return 'no data' if obj is invalid data
  * return obj otherwise */
var validata = function(obj){
  try{
    if(isNil(obj)){
      return 'no data'
    }else{
      return obj
    }
  }catch(e){
    console.log('caught this error while parsing: ',e)
    return 'no data'
  }
};

/** add a new result to container containerId and cache data without validation */
var updateResults = function(newResult, containerId){
  cachedResultIds = $('#'+containerId).data('ids');
  cachedResults[result.id] = result;// add result to cachedResults keyed by id
  return cachedResults;
};

/** check if a word is contained in array stopWords */
var isStopWord = function(word){
  if (stopWords.indexOf(word) == -1){
    return false;
  }else{
    return true;
  }
};

/** select next tab when next button is activated
  * @arg $tabContainer the container for the tabs */
var activateNextTab = function($nextTab){
  $nextTab.siblings('[role=tab][aria-selected=true]').attr('aria-selected','false');// deactivate active tab
  $nextTab.attr('aria-selected','true');// list this tab as active
  $nextTab.prop('disabled',false);// enable tab
  $nextTab.click();// activate tab
  $nextTab.focus();// focus tab
  //location.hash = '#explore-role-tab';// not working...
  $nextTab[0].scrollIntoView()
}

/** wrap an ajax get request */
var executeSearch = function(url, data){
    return $.ajax({
      type: 'GET',
      url: url,
      data: data
    });
  };

var parseResultsArray = function(arr, a){
  var resultLength = a.length;
  for (var i = 0; i < resultLength; i++){
    if(arr.indexOf(a[i].ResourceId) === -1){
      arr.push(a[i].ResourceId);
      getResourceDetail(a[i].ResourceId, 'simple-search-results');
    }
  }
  return arr;
};

var simpleSearch = function(){
  var div = 'simple-search-results';
  clearResultData(div);
  $('#'+div+' *').remove();
  var $searchInput = $('#simple-search-input');
  var queryString = $searchInput.val().toLowerCase().trim();  
  actualSearch(queryString, div);  
};

var actualSearch = function(queryString, div){
  var queryTypes = ["Acronym", "Name", "ShortDescriptionForReports"];
  var $resultsDiv = $('#'+div);
  var results = [];
  var requests = [];
  var arr = [];
  var data = {};
  if (queryString){ // makes sure search string is not empty
    for (var i=0;i<queryTypes.length;i++){
      data[queryTypes[i]] = queryString;
      for (var j=0;j<decisionSectors.length;j++){
        data.DecisionSector = decisionSectors[j];
        requests.push(executeSearch(resourceAdvancedSearchURL, data));
      }
      data ={};
    }
    $.when.apply(null, requests).done(function(){
      for (var i=0; i<arguments.length; i++){
        results = results.concat(arguments[i][0]);
      }
      arr = parseResultsArray(arr, results);
      if (0 === arr.length){
        $resultsDiv.html('<p>No results found.</p>');
     }
    });
  }else{
    $resultsDiv.html('<p>Enter a search term.</p>');
  }
};

var stopPropagation = function(e){
  e.stopPropagation();
};
</script>
</body>
</html>
