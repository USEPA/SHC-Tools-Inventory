<!DOCTYPE html>
<html>
<head>
<title>Parser: parse data from a csv into a js object</title>
</head>
<body>
<h2>Instructions</h2>
<ol>
  <li />Ensure papaparse.js is in the same folder as this file.
  <li />Ensure the csv to parse is in the same folder, named data-to-parse.csv .
  <li />Open this file in a browser.
  <li />Click do via URI.
</ol>
<textarea id="input" rows="10" value="Insert text to be converted"></textarea>
<!-- INSERT A FILE-CHOOSER FOR THE USER TO SELECT A CSV FROM HIS OR HER COMPUTER WHEN BROWSERS PROVIDE BETTER SUPPORT FOR THIS -->
<br />
<br />
<h2>URI Method:</h2>
<button id="uri-btn" onclick="viaURI()">Do Via URI</button>
<h2>Output:</h2>
<div id="output"></div>
<script src="papaparse.js"></script>
<script>

/** requires papaparse.js loaded */
var getData = function(){
  var data = document.getElementById('input').value;
  return data;
};

var parseData = function(gottenData=getData()){
  // use header
  // correct newline for ms xl
  var config = { header: true }
  var parsedData = Papa.parse(gottenData, config);
  return parsedData;
}

var formatData = function(data){
  var objectivesBySubrole = [{},{},{}]
  var relevance;
  var subroleIndex;
  for (var i=0;i<data.length;i++) {
    if (data[i].Primary === "TRUE") {
      relevance = 0;
    } else if (data[i].Secondary === "TRUE") {
      relevance = 1;
    } else {
      relevance = 2;
    }
    if(!objectivesBySubrole[relevance].hasOwnProperty(data[i].SubRole)) {
      objectivesBySubrole[relevance][data[i].SubRole] = [];  
    }
    objectivesBySubrole[relevance][data[i].SubRole].push(data[i]["Means Objective"]);    
  }
  return objectivesBySubrole;
};

function viaURI() {
  var parsedData = parseData();
  var data = JSON.stringify(formatData(parsedData.data));
  //var data = JSON.stringify(parsedData);
  var outputDiv = document.getElementById('output');
  outputDiv.insertAdjacentText('beforeend',data)
/* UNCOMMENT TO DOWNLOAD DATA
  var link = document.createElement("a");
  link.setAttribute("href", 'data:text/csv;charset=utf-8,' + encodeURIComponent(data));
  link.setAttribute("download", "parsed_data.json");
  link.click();
  link.remove();
*/
}

</script>
</body>
<html>
